(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{16151:(e,t,r)=>{"use strict";r.d(t,{CRMProvider:()=>l,m:()=>i});var n=r(95155),a=r(12115);let s={baseUrl:"https://crm.conectaprime.com",apiToken:"",autoSync:!0,syncInterval:5},o={connected:!1,lastTest:null,error:null,responseTime:null},c=(0,a.createContext)(void 0);function l(e){let{children:t}=e,[r,l]=(0,a.useState)(s),[i,u]=(0,a.useState)(o),[m,d]=(0,a.useState)(!1);(0,a.useEffect)(()=>{let e=localStorage.getItem("crm-config"),t=localStorage.getItem("crm-status");if(e)try{l(JSON.parse(e))}catch(e){}if(t)try{let e=JSON.parse(t);e.lastTest&&(e.lastTest=new Date(e.lastTest)),u(e)}catch(e){}},[]),(0,a.useEffect)(()=>{localStorage.setItem("crm-status",JSON.stringify(i))},[i]);let f=async()=>{d(!0);let e=Date.now();try{let t=await fetch("/api/crm-integration?type=test",{method:"GET",headers:{"X-CRM-URL":r.baseUrl,"X-CRM-TOKEN":r.apiToken}}),n=Date.now()-e,a=await t.json();a.success?u({connected:!0,lastTest:new Date,error:null,responseTime:n}):u({connected:!1,lastTest:new Date,error:a.error||"Erro na conex\xe3o",responseTime:n})}catch(t){u({connected:!1,lastTest:new Date,error:t instanceof Error?t.message:"Erro de rede",responseTime:Date.now()-e})}finally{d(!1)}},y=async()=>{d(!0);try{localStorage.setItem("crm-config",JSON.stringify(r)),await f()}catch(e){}finally{d(!1)}};return(0,a.useEffect)(()=>{if(r.autoSync&&i.connected){let e=setInterval(()=>{f()},60*r.syncInterval*1e3);return()=>clearInterval(e)}},[r.autoSync,r.syncInterval,i.connected]),(0,n.jsx)(c.Provider,{value:{config:r,setConfig:l,status:i,setStatus:u,isLoading:m,setIsLoading:d,testConnection:f,saveConfig:y},children:t})}function i(){let e=(0,a.useContext)(c);if(void 0===e)throw Error("useCRM deve ser usado dentro de um CRMProvider");return e}},41290:()=>{},71432:(e,t,r)=>{Promise.resolve().then(r.bind(r,16151)),Promise.resolve().then(r.t.bind(r,95003,23)),Promise.resolve().then(r.t.bind(r,41290,23))},95003:e=>{e.exports={style:{fontFamily:"'Inter', 'Inter Fallback'",fontStyle:"normal"},className:"__className_e8ce0c"}}},e=>{e.O(0,[895,441,255,358],()=>e(e.s=71432)),_N_E=e.O()}]);