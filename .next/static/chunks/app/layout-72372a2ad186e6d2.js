(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{16151:(e,t,r)=>{"use strict";r.d(t,{CRMProvider:()=>l,m:()=>i});var n=r(95155),s=r(12115);let a={baseUrl:"https://crm.conectaprime.com",apiToken:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6InN0YXRpYy1hZG1pbi1pZCIsImVtYWlsIjoiYWRtaW5Ac2VndWlkb3Jlc3ByaW1lLmNvbSIsInJvbGUiOiJhZG1pbiIsInBlcm1pc3NvZXMiOlsiSGlzdMOzcmljbyBkZSBFbnZpb3MiLCJSZWFsaXphciBFbnZpb3MiXSwiaWF0IjoxNzUxNDkwNDk3fQ.FNSAlVtFjpZVTYvkjEVXRRghvTscU0sqdP6H9mk_KgI",autoSync:!0,syncInterval:5},c={connected:!1,lastTest:null,error:null,responseTime:null},o=(0,s.createContext)(void 0);function l(e){let{children:t}=e,[r,l]=(0,s.useState)(a),[i,u]=(0,s.useState)(c),[m,d]=(0,s.useState)(!1);(0,s.useEffect)(()=>{let e=localStorage.getItem("crm-config"),t=localStorage.getItem("crm-status");if(e)try{l(JSON.parse(e))}catch(e){}if(t)try{let e=JSON.parse(t);e.lastTest&&(e.lastTest=new Date(e.lastTest)),u(e)}catch(e){}},[]),(0,s.useEffect)(()=>{localStorage.setItem("crm-status",JSON.stringify(i))},[i]),(0,s.useEffect)(()=>{if(r.apiToken&&""!==r.apiToken&&!i.connected){let e=setTimeout(()=>{f()},1e3);return()=>clearTimeout(e)}},[r.apiToken]);let f=async()=>{d(!0);let e=Date.now();try{let t=await fetch("/api/crm-integration?type=test",{method:"GET",headers:{"X-CRM-URL":r.baseUrl,"X-CRM-TOKEN":r.apiToken}}),n=Date.now()-e,s=await t.json();s.success?u({connected:!0,lastTest:new Date,error:null,responseTime:n}):u({connected:!1,lastTest:new Date,error:s.error||"Erro na conex\xe3o",responseTime:n})}catch(t){u({connected:!1,lastTest:new Date,error:t instanceof Error?t.message:"Erro de rede",responseTime:Date.now()-e})}finally{d(!1)}},p=async()=>{d(!0);try{localStorage.setItem("crm-config",JSON.stringify(r)),await f()}catch(e){}finally{d(!1)}};return(0,s.useEffect)(()=>{if(r.autoSync&&i.connected){let e=setInterval(()=>{f()},60*r.syncInterval*1e3);return()=>clearInterval(e)}},[r.autoSync,r.syncInterval,i.connected]),(0,n.jsx)(o.Provider,{value:{config:r,setConfig:l,status:i,setStatus:u,isLoading:m,setIsLoading:d,testConnection:f,saveConfig:p},children:t})}function i(){let e=(0,s.useContext)(o);if(void 0===e)throw Error("useCRM deve ser usado dentro de um CRMProvider");return e}},41290:()=>{},71432:(e,t,r)=>{Promise.resolve().then(r.bind(r,16151)),Promise.resolve().then(r.t.bind(r,95003,23)),Promise.resolve().then(r.t.bind(r,41290,23))},95003:e=>{e.exports={style:{fontFamily:"'Inter', 'Inter Fallback'",fontStyle:"normal"},className:"__className_e8ce0c"}}},e=>{e.O(0,[895,441,255,358],()=>e(e.s=71432)),_N_E=e.O()}]);